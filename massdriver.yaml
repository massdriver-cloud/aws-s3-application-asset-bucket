# This file will be used to generate all of the schema-*.json files in a bundle
schema: draft-07
name: "aws-s3-application-asset-bucket"
description: "creates an s3 bucket for durable arbitrary blob stroage for application assets"
ref: github.com/massdriver-cloud/aws-s3-application-asset-bucket
access: "public"
type: "bundle"

# schema-params.json
# JSON Schema sans-fields above
params:
  examples:
    - __name: No tiering
      bucket:
        region: us-west-2
        intelligent_tiering:
          enabled: false
    - __name: One year archive
      bucket:
        region: us-west-2
        intelligent_tiering:
          enabled: true
          tiering:
            - days: 365
              access_tier: ARCHIVE_ACCESS

  required:
    - bucket
  properties:
    bucket:
      type: object
      title: bucket 
      description: details of the s3 bucket
      required:
        - region
        - intelligent_tiering
      properties:
        region:
          # TODO does this have to be http ref or can I use a massdriver/ alias? copied this pattern from https://github.com/massdriver-cloud/aws-sns-pubsub-topic/blob/main/massdriver.yaml#L31
          $ref: https://raw.githubusercontent.com/massdriver-cloud/artifact-definitions/main/definitions/types/aws-region.json
        inteligent_tiering:
          type: object
          required:
            - enabled
          properties:
            enabled:
              type: boolean
              title: enabled
              description: "enable inteligent tiering https://docs.aws.amazon.com/AmazonS3/latest/userguide/intelligent-tiering.html"
              default: false
            filter:
              type: object
              title: filter
              default: {}
              properties:
                prefix:
                  type: string
                  title: prefix
                  description: "object prefix to apply inteligent tiering to"
                  default: ""
                tags:
                  type: object
                  title: tags
                  description: "object tags to apply inteligent tiering to"
                  default: ""
            tiering:
              type: array
              items:
                type: object
                title: tiering
                required:
                  - days
                  - access
                properties:
                  days:
                    type: integer
                    title: days
                    description: "number of days to wait before moving to next tier"
                    default: 30
                  access_tier:
                    type: string
                    title: access_tier
                    description: "access tier to move to"
                    enum:
                      - ARCHIVE_ACCESS
                      - DEEP_ARCHIVE_ACCESS
                    default: ARCHIVE_ACCESS

# schema-connections.json
# Named list of input connections (artifacts) (map[name]artifact)
connections:
  required:
  - aws_authentication
  properties:
    aws_authentication:
      $ref: massdriver/aws-iam-role

# schema-artifacts.json
# Named list of output artifacts  (map[name]artifact)
artifacts:
  required:
    - bucket
  properties:
    bucket:
      $ref: massdriver/aws-s3-bucket

# schema-ui.json
# List of form customizations for params-schema
ui:
  ui:order:
    - "*"
  ## set top level ui:wiget
  # secret_key:
  #    ui:widget: "password"
  ## Set key in an array of objects
  # secrets:
  #   items:
  #     mdKeyId:
  #       ui:widget: "hidden"
